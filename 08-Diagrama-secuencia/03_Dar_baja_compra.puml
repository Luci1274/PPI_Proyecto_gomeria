@startuml dar_baja_compra

title Diagrama de Secuencia: Dar de Baja Compra

actor Administrador
boundary "iu_darBajaCompra:IU_DarBajaCompra" as IU
control "cu_darBajaCompra:CU_DarBajaCompra" as CU
entity "cat_comp:CatalogoCompras" as CATC
entity "compra:Compra" as C
entity "cat_prod:CatalogoProductos" as CATP

== Seleccionar Compra ==
Administrador -> IU: seleccionarCompra(idCompra)
activate IU

IU -> CU: solicitarBaja(idCompra)
activate CU

CU -> CATC: buscarCompra(idCompra)
activate CATC
CATC --> CU: compra
deactivate CATC

alt Compra ya anulada
    CU --> IU: informarCompraAnulada()
    IU --> Administrador: mostrarMensaje("La compra ya está dada de baja")
else Compra válida

    IU --> Administrador: solicitarMotivo()

    Administrador -> IU: ingresarMotivo(motivo)
    IU -> CU: validarMotivo(motivo)

    alt Motivo inválido
        CU --> IU: informarMotivoInvalido()
        IU --> Administrador: mostrarMensaje("El motivo no puede estar vacío")
    else Motivo válido

        CU -> C: anular(motivo)

        CU -> CATP: revertirStock(C.items)
        activate CATP
        CATP --> CU: stockActualizado
        deactivate CATP

        CU --> IU: bajaConfirmada()
        IU --> Administrador: mostrarConfirmacion()

    end reminder
end

deactivate CU
deactivate IU

@enduml
