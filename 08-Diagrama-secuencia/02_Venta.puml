@startuml venta

title Diagrama de Secuencia: Registrar Venta

actor Administrador
participant Sistema
participant "cat_fp:Catálogo_forma_pago" as Cat_fp
participant "multi:Multiobjeto" as MULT

== Registro de Detalles de Venta ==
Administrador -> Sistema: Ingresar_detalles_venta(fecha, forma_pago, descuento, factura, iva)
activate Sistema
Sistema -> Cat_fp: Validar_forma_pago(forma_pago)
activate Cat_fp
Cat_fp --> Sistema: Resultado_validación
deactivate Cat_fp

opt Forma de pago inválida
    Sistema --> Administrador: <<"Datos incorrectos">>
end

create "venta:Venta" as V
Sistema -> V: Crear_venta(fecha, forma_pago, descuento, factura, iva)
activate V
Sistema -> MULT: Guardar_detalles_venta()
deactivate V
Sistema --> Administrador: <<"Venta registrada exitosamente">>
deactivate Sistema

== Agregar Ítems a la Venta ==
loop tantas veces como se desee
    Administrador -> Sistema: Click("Agregar ítem venta")
    activate Sistema
    alt Producto no existe
        Sistema --> Administrador: <<"Error: producto no encontrado">>
    else Producto existente
        Administrador -> Sistema: Aceptar_item()
        Sistema -> V: Agregar_item(nombre_producto, precio_unitario, cantidad)
        activate V
        Sistema -> MULT: Guardar_item_venta()
        Sistema --> Administrador: <<"Item guardado con exito">>
        deactivate V
        deactivate Sistema
    end

    opt Cancelar ítem
        Administrador -> Sistema: Click("Cancelar")
        activate Sistema
        Sistema --> Administrador: <<"Item cancelado con exito">>
         deactivate Sistema
    end
end

== Finalizar Venta ==
alt Cancelar Venta
    Administrador -> Sistema: Click("Cancelar Venta")
    activate Sistema
    Sistema --> Administrador: <<"Venta cancelado con exito">>
else
    Administrador -> Sistema: Click("Finalizar Venta")
    Sistema -> V: Generar_resumen()
    activate V
    Sistema --> Administrador: <<"Venta finalizada con exito">>
    deactivate Sistema
end
deactivate V

== Confirmar y Cierre ==
Administrador -> Sistema: Click("Confirmar Venta")
activate Sistema
Sistema -> V: Confirmar()
activate V
Sistema -> MULT: Guardar_venta(venta)
deactivate V
Sistema --> Administrador: <<"Venta confirmada exitosamente">>
deactivate Sistema

Administrador -> Sistema: Imprimir_ticket() / Ver_historial_ventas()
activate Sistema
Sistema --> Administrador: <<"Mostrar_ticket_o_historial">>
deactivate Sistema
deactivate V

@enduml