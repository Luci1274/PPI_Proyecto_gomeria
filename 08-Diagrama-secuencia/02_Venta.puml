@startuml venta

title Diagrama de Secuencia: Registrar Venta

actor Administrador as Admin 
participant Sistema as System
participant Catálogo as Cat
participant Multiobjeto as MULT

== Registro de Forma de Pago ==
Admin -> System: Seleccionar_forma_de_pago()
activate System
System -> Cat: Validar_forma_pago()
activate Cat
Cat --> System: Resultado_validación
deactivate Cat

alt Forma de pago válida
   create Pago
   System -> Pago: Crear(formapago)
   activate Pago
   System -> MULT: Guardar_forma_pago(Pago)
   activate MULT
   MULT --> System: Confirmar_guardado()
   deactivate MULT
   System --> Admin: Mostrar_confirmacion("Forma de pago registrada")
   destroy Pago
else Forma de pago inválida
   System --> Admin: Mostrar_error("Forma de pago inválida")
end
deactivate System

== Selección de Producto ==
Admin -> System: Seleccionar_producto()
activate System
System -> Cat: Consultar_producto()
activate Cat
Cat --> System: Devolver_producto()
deactivate Cat
System --> Admin: Mostrar_producto()
deactivate System

== Registro de Ítems de Venta ==
loop hasta datos válidos
   Administrador -> System: Ingresar_datos_item(cantidad, precio_unitario, producto)
   activate System
   System -> Cat: Validar_disponibilidad_producto()
   activate Cat
   Cat --> System: Resultado_validación
   deactivate Cat

   alt Datos válidos
      create ItemVenta
      System -> ItemVenta: Crear(datos_item)
      activate ItemVenta
      System -> MULT: Guardar_item_venta(ItemVenta)
      activate MULT
      MULT --> System: Confirmar_guardado()
      deactivate MULT
      System --> Admin: Mostrar_confirmacion("Ítem registrado")
      destroy ItemVenta
   else Datos inválidos
      System --> Admin: Mostrar_error("Datos del ítem inválidos o producto sin stock")
   end
   deactivate System
end

== Modificación o Eliminación de Ítems ==
loop hasta datos válidos
   Admin -> System: Modificar_o_eliminar_item()
   activate System
   System -> Cat: Validar_modificacion_item()
   activate Cat
   Cat --> System: Resultado_validación
   deactivate Cat

   alt Datos válidos
      create ItemModificado
      System -> ItemModificado: Crear(datos_modificados)
      activate ItemModificado
      System -> MULT: Actualizar_item_venta(ItemModificado)
      activate MULT
      MULT --> System: Confirmar_actualizacion()
      deactivate MULT
      System --> Administrador: Mostrar_confirmacion("Ítem actualizado")
      destroy ItemModificado
   else Datos inválidos
      System --> Administrador: Mostrar_error("Datos del ítem inválidos")
   end
   deactivate System
end

== Confirmación de Venta ==
Admin -> System: Confirmar_venta()
activate System
create Venta
System -> Venta: Crear(datos_venta)
activate Venta
System -> MULT: Guardar_venta(Venta)
activate MULT
MULT --> System: Confirmar_guardado()
deactivate MULT
System --> Admin: Mostrar_confirmacion("Venta registrada correctamente")
destroy Venta
deactivate System

== Filtrado o Consulta de Ventas ==
loop hasta datos de filtrado válidos
   Admin -> System: Aplicar_filtro(fecha, cliente, forma_pago)
   activate System
   System -> Cat: Obtener_listado_filtrado()
   activate Cat
   Cat --> System: Devolver_listado_filtrado()
   deactivate Cat
   System --> Admin: Mostrar_listado_filtrado()
   deactivate System
end

@enduml
