@startuml venta

title Diagrama de Secuencia: Registrar Venta

actor Administrador
participant Sistema
participant Catálogo as Cat
participant Multiobjeto as MULT

== Registro de Forma de Pago ==
Administrador -> Sistema: Seleccionar_forma_de_pago()
activate Sistema
Sistema -> Cat: Validar_forma_pago()
activate Cat
Cat --> Sistema: Resultado_validación
deactivate Cat

alt Forma de pago válida
   create Pago
   Sistema -> Pago: Crear(formapago)
   activate Pago
   Sistema -> MULT: Guardar_forma_pago(Pago)
   activate MULT
   MULT --> Sistema: Confirmar_guardado()
   deactivate MULT
   Sistema --> Administrador: Mostrar_confirmacion("Forma de pago registrada")
   destroy Pago
else Forma de pago inválida
   Sistema --> Administrador: Mostrar_error("Forma de pago inválida")
end
deactivate Sistema

== Selección de Producto ==
Administrador -> Sistema: Seleccionar_producto()
activate Sistema
Sistema -> Cat: Consultar_producto()
activate Cat
Cat --> Sistema: Devolver_producto()
deactivate Cat
Sistema --> Administrador: Mostrar_producto()
deactivate Sistema

== Registro de Ítems de Venta ==
loop hasta datos válidos
   Administrador -> Sistema: Ingresar_datos_item(cantidad, precio_unitario, producto)
   activate Sistema
   Sistema -> Cat: Validar_disponibilidad_producto()
   activate Cat
   Cat --> Sistema: Resultado_validación
   deactivate Cat

   alt Datos válidos
      create ItemVenta
      Sistema -> ItemVenta: Crear(datos_item)
      activate ItemVenta
      Sistema -> MULT: Guardar_item_venta(ItemVenta)
      activate MULT
      MULT --> Sistema: Confirmar_guardado()
      deactivate MULT
      Sistema --> Administrador: Mostrar_confirmacion("Ítem registrado")
      destroy ItemVenta
   else Datos inválidos
      Sistema --> Administrador: Mostrar_error("Datos del ítem inválidos o producto sin stock")
   end
   deactivate Sistema
end

== Modificación o Eliminación de Ítems ==
loop hasta datos válidos
   Administrador -> Sistema: Modificar_o_eliminar_item()
   activate Sistema
   Sistema -> Cat: Validar_modificacion_item()
   activate Cat
   Cat --> Sistema: Resultado_validación
   deactivate Cat

   alt Datos válidos
      create ItemModificado
      Sistema -> ItemModificado: Crear(datos_modificados)
      activate ItemModificado
      Sistema -> MULT: Actualizar_item_venta(ItemModificado)
      activate MULT
      MULT --> Sistema: Confirmar_actualizacion()
      deactivate MULT
      Sistema --> Administrador: Mostrar_confirmacion("Ítem actualizado")
      destroy ItemModificado
   else Datos inválidos
      Sistema --> Administrador: Mostrar_error("Datos del ítem inválidos")
   end
   deactivate Sistema
end

== Confirmación de Venta ==
Administrador -> Sistema: Confirmar_venta()
activate Sistema
create Venta
Sistema -> Venta: Crear(datos_venta)
activate Venta
Sistema -> MULT: Guardar_venta(Venta)
activate MULT
MULT --> Sistema: Confirmar_guardado()
deactivate MULT
Sistema --> Administrador: Mostrar_confirmacion("Venta registrada correctamente")
destroy Venta
deactivate Sistema

== Filtrado o Consulta de Ventas ==
loop hasta datos de filtrado válidos
   Administrador -> Sistema: Aplicar_filtro(fecha, cliente, forma_pago)
   activate Sistema
   Sistema -> Cat: Obtener_listado_filtrado()
   activate Cat
   Cat --> Sistema: Devolver_listado_filtrado()
   deactivate Cat
   Sistema --> Administrador: Mostrar_listado_filtrado()
   deactivate Sistema
end

@enduml
