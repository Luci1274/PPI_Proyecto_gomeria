@startuml registrar_compra

title Diagrama de Secuencia: Registrar Compra

actor Administrador
boundary "iu_registrarCompra:IU_RegistrarCompra" as IU
control "cu_registrarCompra:CU_RegistrarCompra" as CU
entity "cat_prov:CatalogoProveedores" as CP
entity "compra:Compra" as C
entity "item:ItemCompra" as IC
entity "cat_prod:CatalogoProductos" as PROD

== Crear Compra ==
Administrador -> IU: ingresarDatosCompra(proveedor, formaPago)
activate IU

IU -> CU: crearCompra(proveedor, formaPago)
activate CU

CU -> CP: buscarProveedor(idProv)
activate CP
CP --> CU: proveedor
deactivate CP

create C
CU -> C: inicializar(proveedor, formaPago, estado=Pendiente)

== Registrar Ítems ==
loop por cada ítem
    Administrador -> IU: ingresarItem(prod,cant,precio)
    IU -> CU: agregarItem(prod,cant,precio)

    CU -> PROD: buscarProducto(prod)
    activate PROD
    PROD --> CU: producto
    deactivate PROD

    create IC
    CU -> IC: inicializar(producto,cantidad,precio)

    CU -> C: agregarItem(IC)
end

== Confirmar Compra ==
Administrador -> IU: confirmarCompra()
IU -> CU: confirmarCompra()

CU -> C: confirmar()

CU -> PROD: actualizarStock(items)
activate PROD
PROD --> CU: stockActualizado
deactivate PROD

CU --> IU: compraRegistrada()
IU --> Administrador: mostrarConfirmacion()

deactivate CU
deactivate IU

@enduml
