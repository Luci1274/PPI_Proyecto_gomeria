@startuml venta

title Diagrama de Secuencia: Registrar Venta

actor Administrador
participant Sistema
participant "cat_fp:Catálogo_forma_pago" as Cat_fp
participant "multi:Multiobjeto" as MULT

== Registro de Detalles de Venta ==
Administrador -> Sistema: Ingresar_detalles_venta(fecha, forma_pago, factura, iva)
activate Sistema
Sistema -> Cat_fp: Validar_forma_pago(forma_pago)
activate Cat_fp
Cat_fp --> Sistema: Resultado_validación
deactivate Cat_fp

opt Forma de pago inválida
    Sistema --> Administrador: <<"Datos incorrectos">>
end

create "venta:Venta" as V
Sistema -> V: Crear_venta(fecha, forma_pago, descuento, factura, iva)
activate V
Sistema -> MULT: Guardar_detalles_venta()
activate MULT
deactivate MULT
deactivate V
Sistema --> Administrador: <<"Venta registrada exitosamente">>
deactivate Sistema

== Agregar Ítems a la Venta ==
loop tantas veces como se desee y/o hasta datos correctos
    
    Administrador -> Sistema: Aceptar_item()
    activate Sistema
    Sistema -> V: Agregar_item(nombre_producto, precio_unitario, cantidad)
    activate V
    Sistema -> MULT: Guardar_item_venta()
    activate MULT
    deactivate MULT
    Sistema --> Administrador: <<"Item guardado con exito">>
    deactivate V
    
    opt Producto no existe 
        Sistema --> Administrador: <<"Error: producto no encontrado">>
        deactivate Sistema
    end

    opt Cancelar ítem
        Administrador -> Sistema: Cancelar_item()
        activate Sistema
        Sistema --> Administrador: <<"Item cancelado con exito">>
         deactivate Sistema
    end
end

== Finalizar Venta ==
Administrador -> Sistema: Finalizar_venta()
activate Sistema
Sistema -> V: Generar_resumen(descuento_total)
activate V
Sistema --> Administrador: <<"Venta finalizada con exito">>

opt Cancelar Venta
    Administrador -> Sistema: Cancelar_venta()
    Sistema --> Administrador: <<"Venta cancelado con exito">>
    deactivate Sistema
end
deactivate V

== Confirmar y Cierre ==
Administrador -> Sistema: Confirmar_venta()
activate Sistema
Sistema -> V: Confirmar()
activate V
Sistema -> MULT: Guardar_venta(venta)
activate MULT
deactivate MULT
deactivate V
Sistema --> Administrador: <<"Venta confirmada exitosamente">>
deactivate Sistema

@enduml